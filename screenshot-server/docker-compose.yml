# docker-compose.yml - Screenshot Server (API + Celery Worker)
services:
  screenshot-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: brickers-screenshot:latest
    container_name: brickers-screenshot-api
    restart: unless-stopped
    ports:
      - "8002:8002"
    env_file:
      - .env
    environment:
      - TZ=Asia/Seoul
      - PYTHONUNBUFFERED=1
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - NANO_BANANA_MODEL=${NANO_BANANA_MODEL}
    command: ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8002"]

  screenshot-worker:
    build:
      context: .
      dockerfile: Dockerfile
    image: brickers-screenshot:latest
    container_name: brickers-screenshot-worker
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - TZ=Asia/Seoul
      - PYTHONUNBUFFERED=1
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - NANO_BANANA_MODEL=${NANO_BANANA_MODEL}
    command: ["celery", "-A", "celery_app", "worker",
              "--loglevel=info", "--concurrency=1", "--pool=solo",
              "-Q", "celery-screenshots"]
