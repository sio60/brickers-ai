# docker-compose.yml (최적화 버전)
services:
  app:
    # 로컬 빌드 사용 (또는 수동으로 빌드한 이미지)
    build:
      context: .
      dockerfile: Dockerfile.optimized
    image: brickers-ai:base
    container_name: brickers-ai-container
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      # ✅ 핵심: 소스코드를 볼륨 마운트 (패키지는 이미지에 설치됨)
      - ./route:/app/route
      - ./brick-engine:/app/brick-engine
      - ./app.py:/app/app.py
      - ./config.py:/app/config.py
      - ./.env:/app/.env
      # public 폴더 (선택사항)
      - ./public:/app/public
    environment:
      - KIDS_TOTAL_TIMEOUT_SEC=840
      - TRIPO_WAIT_TIMEOUT_SEC=780
      - S3_PREFIX=uploads/ai-generated
      # PYTHONUNBUFFERED: 로그 즉시 출력
      - PYTHONUNBUFFERED=1
