프로젝트 작업 현황 및 데이터 기반 증거 종합 보고서

본 문서는 오늘 진행된 물리 검증 시스템 분석 및 테스트 결과, 그리고 코드 개선 사항을 종합한 데이터 기반 보고서입니다.

---

1. 수행 작업 요약

| 분류 | 주요 내용 | 관련 파일 |
|------|----------|----------|
| 코드 분석 | 기존 AABB 기반 물리 검증 로직 및 데이터 흐름 파악 | verifier.py, ldr_loader.py |
| 버그 수정 | run_all_checks 결과 반환 누락 에러 해결 | verifier.py |
| 구조 개선 | db.py 모듈화 및 위치 변경, 임포트 경로 최적화 | db.py, part_library.py |
| 품질 검증 | 테스트용 LDR 모델 생성 및 시나리오별 검증 | pyramid.ldr, fail_test.ldr |

---

2. 물리 검증 평가 기준 (Evaluation Standards)

현재 시스템이 '물리적으로 가능한 모델'인지 판단하기 위해 사용하는 구체적인 기준과 수치입니다. (기본 100점에서 감정 방식)

실패 판정 (Hard Fail / 0점 처리)
아래 항목 중 하나라도 해당하면 is_valid = False가 되며 즉시 0점 처리됩니다.

| 검증 항목 | 물리적 의미 | 실패(Fail) 조건 |
|:---|:---|:---|
| Floating | 공중 부유 | 지면(z=0)에서부터 연결 그래프가 끊긴 브릭이 존재할 경우 |
| Collision | 불가능한 충돌 | 두 박스 간 겹침 볼륨이 10%를 초과할 경우 (기계 파트 제외) |
| Stability | 전도(넘어짐) | 전체 무게중심(COM)이 지면 지지 면적(Convex Hull) 밖에 있을 경우 |
| Heavy Collision | 대규모 충돌 | 모델 내에 크리티컬 충돌이 20개 이상 발견될 경우 |

감점 판정 (Warning / 점수 차감)
구조적으로 약하거나 권장하지 않는 방식으로, 건당 점수가 차감됩니다.

| 검증 항목 | 상세 기준 | 감점 수치 |
|:---|:---|:---|
| Weak Connection | 1개 스터드만으로 연결된 브릭 (회전에 취약) | 건당 -10점 |
| Overhang | 아래 브릭에 의해 지지되는 면적이 30% 미만인 경우 | 건당 -20점 |
| Stability (Loose)| 엄격한 기준은 통과했으나 물리적으로 불안정해 보일 때 | 최대 -50점 |

특수 파트 보정 (Relaxation)
LDraw 데이터의 특수성을 고려한 예외 처리 기준입니다.

- 스터드 보정: 수직 겹침 계산 시 스터드 높이(0.17 LDU)를 빼고 순수 부피 충돌만 계산합니다.
- 기계 파트 허용: 바퀴(Wheel), 테크닉 핀, 미니피겨 머리카락 등 결합이 필요한 파트는 겹침 허용 범위를 85%까지 대폭 완화합니다. (단, 이는 현재 키워드 매칭 방식의 한계임)

---

3. 데이터 기반 실측 증거 (Evidence)

현재 시스템의 한계점을 입증하는 핵심 데이터 테스트 결과입니다.

Case A: 형상 단순화의 한계 ( car.ldr )
- 테스트 결과: 0.0점 (FAIL)
- 실측 데이터:
    - Mudguard 파트 내부 조립 시 28.3% 겹침 발생.
    - 실제 조립은 가능하나, AABB(박스) 처리로 인해 '물리적 불가' 판정.
- 결론: 비정형 파트(아치, 구멍, 경사)에 대한 오탐지(False Positive) 해결 불가능.

Case B: 성능 한계 및 대형 모델 검증 ( container_ship_upright.ldr )
- 테스트 결과: PASS (성공)
- 실측 데이터:
    - 브릭 수: 2,265개.
    - 페어와이즈 충돌 검사 횟수: 2,564,020회 (O(N^2)).
- 분석 결과:
    - 정확도: 브릭이 2,000개가 넘는 복잡한 대형 모델임에도 불구하고, 데이터 누락 없이 모든 물리적 연결성을 정확히 파악하여 최종 검증에 성공함. 시스템의 로직 신뢰성을 증명함.
    - 성능: 단, O(N^2) 연산 방식으로 인해 검증 완료까지 수 분 이상 소요됨. 이는 핵심 알고리즘의 최적화가 필요함을 시사함.

Case C: 로직 검증 ( fail_test.ldr )
- 테스트 결과: 공중 부유 및 100% 충돌 정상 감지.
- 데이터:
    - 공중 부유 브릭 → 즉시 검단 중단 및 0점 처리.
    - 100% 중복 좌표 브릭 → 충돌 크리티컬 에러 발생.

Case D: 무게 중심 계산 정밀도 ( shark_spar3d_voxel.ldr )
- 테스트 결과: FAIL (실패)
- 실측 데이터:
    - 브릭 수: 1,907개
    - 실패 원인: "Global Center of Mass is outside the support base polygon."
    - 현상: 전체 모델의 무게 중심이 바닥 지지 범위를 벗어나 전도(넘어짐) 위험이 높음.
- 분석: 수학적 계산(AABB)을 통해 무게 중심 불균형을 정확히 잡아냈음. 그러나 실제 물리 환경에서 어느 방향으로, 얼마나 빨리 넘어지는지 시뮬레이션하기 위해서는 물리 엔진(PyBullet) 도입이 필수적임을 다시 한번 증명함.

---

4. 구조적 차이점 비교 (현 구조 vs 제안 구조)

| 항목 | 현재 시스템 (기하학적 접근) | 제안 시스템 (PyBullet 물리적 접근) |
|------|--------------------------|---------------------------------|
| 파트 표현 | 단순 박스 (AABB) | 실제 메시 (VHACD Convex 분해) |
| 연산 속도 | O(N^2) (모든 쌍 대조) | O(N log N) (공간 분할 가속) |
| 조립 인식 | 단일 박스 겹침만 계산 | Constraint 기반 결합 모델링 |
| 정밀도 | 회전/경사 시 오차 발생 | 실제 형상 기반 정밀 검사 가능 |

---

5. 최종 제안 및 로드맵

핵심 제안
"현재 시스템은 소규모 단순 모델 검증에는 적합하나, 실제 조립 맥락(Joint)을 이해하지 못하고 대형 모델에서 성능이 급락함. 이를 해결하기 위해 PyBullet 물리 엔진으로의 전환이 필수적임."

향후 계획
1. Short-term: PyBullet 환경 구축 및 LDR-to-Mesh 변환 파이프라인 개발
2. Mid-term: Constraint 기반 자동 결합 로직 및 동적 안정성 테스트 구현
3. Long-term: 시뮬레이션 데이터를 활용한 AI 학습 보상 모델 최적화

---
종합 의견: 실측 데이터가 보여주듯, 현재의 방식은 확장성 한계에 도달함. PyBullet 전환을 통해 정확도와 성능이라는 두 마리 토끼를 잡아야 함.
